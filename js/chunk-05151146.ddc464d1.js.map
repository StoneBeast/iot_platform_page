{"version":3,"sources":["webpack:///./src/utils/formatDate.js","webpack:///./src/components/mainAppHeader.vue","webpack:///./src/views/deviceList/index.vue","webpack:///./src/views/deviceList/index.vue?bb81","webpack:///./src/apis/device.js","webpack:///./src/views/deviceList/component/editDrawer.vue","webpack:///./src/views/deviceList/component/editDrawer.vue?f5ff","webpack:///./src/components/mainAppHeader.vue?d5c9","webpack:///./src/views/deviceList/index.vue?1a8f"],"names":["formatDate","time","format","date","Date","year","getFullYear","month","getMonth","day","getDate","hour","getHours","min","getMinutes","sec","getSeconds","preArr","Array","apply","map","elem","index","replace","__exports__","drawerSwitch","ref","routerStore","useRouterStore","productId","deviceList","reactive","deviceIdList","timer","getStatusTimerFun","updateDeviceStatus","setTimeout","onMounted","getDeviceList","onUnmounted","clearTimeout","deviceCount","onlineDeviceCount","isLoading","page","pageSize","value","fetchDeviceList","then","res","code","data","total","devicelist","splice","forEach","item","push","deviceId","lastOnlineTime","deviceStatus","ElMessage","type","message","finally","router","useRouter","handleToChildPage","routerName","name","params","fetchDeviceStatus","device","deviceIdItem","handleClickDel","deleteDevice","addDevice","request","url","method","fetchDeviceInfo","deviceDataUploadInfo","sendCommand","fetchCommandList","addApiKey","isShowDrawer","deviceForm","watch","props","JSON","stringify","deviceEditData","deviceData","deviceName","deviceAuthentication","deviceIntroduction","rules","required","trigger","max","handleFetchDeviceList","emits","isButtonLoading","resetForm","form","resetFields","handleAddDevice","validate","isValid"],"mappings":"gHAAO,SAASA,EAAWC,EAAMC,EAAS,qBACxC,MAAMC,EAAO,IAAIC,KAAKH,GAEhBI,EAAOF,EAAKG,cACZC,EAAQJ,EAAKK,WAAa,EAC1BC,EAAMN,EAAKO,UACXC,EAAOR,EAAKS,WACZC,EAAMV,EAAKW,aACXC,EAAMZ,EAAKa,aACXC,EAASC,MAAMC,MAAM,KAAMD,MAAM,KAAKE,KAAI,SAASC,EAAMC,GAC7D,MAAO,IAAMA,KAIf,OAAOpB,EAAOqB,QAAQ,MAAOlB,GAC1BkB,QAAQ,MAAON,EAAOV,IAAUA,GAChCgB,QAAQ,MAAON,EAAOR,IAAQA,GAC9Bc,QAAQ,MAAON,EAAON,IAASA,GAC/BY,QAAQ,MAAON,EAAOJ,IAAQA,GAC9BU,QAAQ,MAAON,EAAOF,IAAQA,GAnBnC,mC,kaCMA,MAAMS,EAA2B,IAAgB,EAAQ,CAAC,CAAC,YAAY,qBAExD,U,k2CCmFf,MAAMC,EAAeC,kBAAI,GACnBC,EAAcC,iBACdC,EAAYH,iBAAIC,EAAYE,WAC5BC,EAAaC,sBAAS,IACtBC,EAAeD,sBAAS,IAC9B,IAAIE,EACJ,SAASC,IACPC,IACAF,EAAQG,WAAWF,EAAmB,KAExCG,uBAAU,KACRC,IACAJ,MAGFK,yBAAY,KACVC,aAAaP,KAGf,MAAMQ,EAAcf,iBAAI,GAClBgB,EAAoBhB,iBAAI,GACxBiB,EAAYjB,kBAAI,GACtB,SAASY,EAAcM,EAAO,EAAGC,EAAW,GAC1CF,EAAUG,OAAQ,EAClBC,eAAgB,CAAElB,UAAWA,EAAUiB,MAAOF,OAAMC,aAAYG,KAAKC,IAClD,MAAbA,EAAIC,MACNT,EAAYK,MAAQG,EAAIE,KAAKC,MAC7BV,EAAkBI,MAAQ,EAEtBG,EAAIE,KAAKE,aACXrB,EAAasB,OAAO,GACpBL,EAAIE,KAAKE,WAAWE,QAAQC,IAC1BxB,EAAayB,KAAKD,EAAKE,UACvBF,EAAKG,eAAiB3D,eAAWwD,EAAKG,gBACZ,OAAtBH,EAAKI,eACPlB,EAAkBI,QAClBU,EAAKG,eAAiB,WAG1B7B,EAAWwB,OAAO,GAClBxB,EAAW2B,QAAQR,EAAIE,KAAKE,cAER,MAAbJ,EAAIC,OAEbT,EAAYK,MAAQ,EACpBhB,EAAWwB,OAAO,KAEnB,KACDO,eAAU,CACRC,KAAM,QACNC,QAAS,WAEVC,QAAQ,KACTrB,EAAUG,OAAQ,IAItB,MAAMmB,EAASC,iBACf,SAASC,EAAkB7C,EAAO8C,GAChCH,EAAOR,KAAK,CAAEY,KAAMD,EAAYE,OAAQ,CAAEzC,UAAWF,EAAYE,UAAW6B,SAAU5B,EAAWR,GAAOoC,YAG1G,SAASvB,IACPoC,eAAkB,CAAE1C,UAAWF,EAAYE,UAAW6B,SAAU1B,IAAgBgB,KAAKC,IAClE,MAAbA,EAAIC,MACNpB,EAAWyB,QAAQiB,IACjBvB,EAAIE,KAAKI,QAAQkB,IACXD,EAAOd,WAAae,EAAaf,WACnCc,EAAOZ,aAAea,EAAab,aACX,OAAxBY,EAAOZ,aACHY,EAAOb,eAAiB,QACxBa,EAAOb,eAAiB3D,eAAWyE,EAAad,uBAOhE,SAASe,EAAepD,GACtBqB,EAAUG,OAAQ,EAClB6B,eAAa,CAAE9C,UAAWF,EAAYE,UAAW6B,SAAU5B,EAAWR,GAAOoC,WAAYV,KAAKC,IAC3E,MAAbA,EAAIC,OACNW,eAAU,CACRC,KAAM,UACNC,QAAS,SAEXzB,MAED,KACDuB,eAAU,CACRC,KAAM,QACNC,QAAS,WAEVC,QAAQ,KACTrB,EAAUG,OAAQ,I,88HCnLtB,MAAMtB,EAA2B,IAAgB,EAAQ,CAAC,CAAC,YAAY,qBAExD,gB,2DCRf,kUAEO,SAASoD,EAAUzB,GACxB,OAAO0B,eAAQ,CACbC,IAAK,sBACLC,OAAQ,OACR5B,SAIG,SAASJ,EAAgBuB,GAC9B,OAAOO,eAAQ,CACbC,IAAK,4BACLC,OAAQ,MACRT,WAIG,SAASU,EAAgBV,GAC9B,OAAOO,eAAQ,CACbC,IAAK,4BACLC,OAAQ,MACRT,WAIG,SAASC,EAAkBpB,GAChC,OAAO0B,eAAQ,CACbC,IAAK,8BACLC,OAAQ,OACR5B,SAIG,SAAS8B,EAAqBX,GACnC,OAAOO,eAAQ,CACbC,IAAK,iCACLC,OAAQ,MACRT,WAIG,SAASK,EAAaL,GAC3B,OAAOO,eAAQ,CACbC,IAAK,yBACLC,OAAQ,SACRT,WAIG,SAASY,EAAY/B,GAC1B,OAAO0B,eAAQ,CACbC,IAAK,wBACLC,OAAQ,OACR5B,SAIG,SAASgC,EAAiBb,GAC/B,OAAOO,eAAQ,CACbC,IAAK,6BACLC,OAAQ,MACRT,WAIG,SAASc,EAAUd,GACxB,OAAOO,eAAQ,CACbC,IAAK,sBACLvE,MAAO,MACP+D,a,6dChBEe,EAAe3D,kBAAI,GACnB4D,EAAa5D,iBAAI,MACjBqC,EAAUrC,iBAAI,UAEpB6D,mBACE,IAAMC,EAAM/D,aACZ,KAE+C,OAAzCgE,KAAKC,UAAUF,EAAMG,iBACvBC,EAAWC,WAAaL,EAAMG,eAAeE,WAC7CD,EAAWE,qBAAuBN,EAAMG,eAAeG,qBACvDF,EAAWG,mBAAqBP,EAAMG,eAAeI,mBACrDH,EAAWlC,SAAW8B,EAAMG,eAAejC,SAC3CK,EAAQjB,MAAQ,WAEhB8C,EAAWlC,SAAW,GACtBkC,EAAWC,WAAa,GACxBD,EAAWE,qBAAuB,GAClCF,EAAWG,mBAAqB,GAChChC,EAAQjB,MAAQ,UAGlBuC,EAAavC,OAAQ,IAIzB,MAAMnB,EAAcC,iBACdgE,EAAa7D,sBAAS,CAC1BF,UAAWF,EAAYE,UACvB6B,SAAU,GACVmC,WAAY,GACZC,qBAAsB,GACtBC,mBAAoB,KAEhBC,EAAQjE,sBAAS,CACrB8D,WAAY,CACV,CAAEI,UAAU,EAAMlC,QAAS,UAAWmC,QAAS,QAC/C,CAAErF,IAAK,EAAGsF,IAAK,GAAIpC,QAAS,WAAYmC,QAAS,SAEnDJ,qBAAsB,CACpB,CAAEG,UAAU,EAAMlC,QAAS,aAAcmC,QAAS,QAClD,CAAErF,IAAK,EAAGsF,IAAK,GAAIpC,QAAS,WAAYmC,QAAS,SAEnDH,mBAAoB,CAClB,CAAElF,IAAK,EAAGsF,IAAK,GAAIpC,QAAS,cAAemC,QAAS,WAIxD,SAASE,IACPC,EAAM,aAGR,MAAMC,EAAkB5E,kBAAI,GAC5B,SAAS6E,EAAUC,GACjBnB,EAAavC,OAAQ,EACrBwD,EAAgBxD,OAAQ,EACxB0D,EAAKC,cAEP,SAASC,IACPpB,EAAWxC,MAAM6D,SAASC,IACpBA,IACFN,EAAgBxD,OAAQ,EACxB8B,eAAUgB,GAAY5C,KAAKC,IACR,MAAbA,EAAIC,MACNW,eAAU,CACRC,KAAM,UACNC,QAASA,EAAQjB,QAEnBsD,IACAf,EAAavC,OAAQ,GAErBe,eAAU,CACRC,KAAM,QACNC,QAAS,UAGZ,KACDF,eAAU,CACRC,KAAM,QACNC,QAAS,WAEVC,QAAQ,KACTsC,EAAgBxD,OAAQ,O,02DCrIhC,MAAMtB,EAAc,EAEL,U,kCCLf,W,kCCAA","file":"js/chunk-05151146.ddc464d1.js","sourcesContent":["export function formatDate(time, format = 'YY-MM-DD hh:mm:ss') {\r\n  const date = new Date(time)\r\n\r\n  const year = date.getFullYear()\r\n  const month = date.getMonth() + 1 // 月份是从0开始的\r\n  const day = date.getDate()\r\n  const hour = date.getHours()\r\n  const min = date.getMinutes()\r\n  const sec = date.getSeconds()\r\n  const preArr = Array.apply(null, Array(10)).map(function(elem, index) {\r\n    return '0' + index\r\n  })\r\n  // 开个长度为10的数组 格式为 00 01 02 03\r\n\r\n  return format.replace(/YY/g, year)\r\n    .replace(/MM/g, preArr[month] || month)\r\n    .replace(/DD/g, preArr[day] || day)\r\n    .replace(/hh/g, preArr[hour] || hour)\r\n    .replace(/mm/g, preArr[min] || min)\r\n    .replace(/ss/g, preArr[sec] || sec)\r\n}\r\n","import script from \"./mainAppHeader.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./mainAppHeader.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./mainAppHeader.vue?vue&type=style&index=0&id=4b858026&scoped=true&lang=css\"\n\nimport exportComponent from \"D:\\\\javaWeb\\\\vuePro\\\\xin_gong_ke\\\\iot-page\\\\node_modules\\\\.pnpm\\\\vue-loader@16.8.3_5vqgdkn543z7gobmtemdwwisxa\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-4b858026\"]])\n\nexport default __exports__","<template>\r\n  <div id=\"container-device-list\">\r\n    <edit-drawer :drawer-switch=\"drawerSwitch\" :drawer-title=\"'添加新设备'\" @onUpdated=\"getDeviceList\" />\r\n    <main-app-header page-title=\"设备列表\" />\r\n    <div id=\"header-container\" class=\"container-context\">\r\n      <div id=\"count-device\" class=\"container-info\">\r\n        <span class=\"title-header\">{{ '设备总数' }}</span><br>\r\n        <span>{{ deviceCount }}</span>\r\n      </div>\r\n      <div id=\"count-online-device\" class=\"container-info\">\r\n        <span class=\"title-header\">{{ '在线设备' }}</span><br>\r\n        <span>{{ onlineDeviceCount }}</span>\r\n      </div>\r\n      <div id=\"id-product\" class=\"container-info\">\r\n        <span class=\"title-header\">{{ '产品ID' }}</span><br>\r\n        <span>{{ productId }}</span>\r\n      </div>\r\n      <div id=\"action-area\">\r\n        <el-button type=\"primary\" @click=\"drawerSwitch = !drawerSwitch\"><el-icon><ElementPlus /></el-icon><span>添加设备</span></el-button>\r\n      </div>\r\n    </div>\r\n    <div id=\"container-body\" class=\"container-context\">\r\n      <el-table v-loading=\"isLoading\" :data=\"deviceList\" style=\"width: 100%\">\r\n        <el-table-column prop=\"deviceId\" label=\"设备ID\" width=\"180\" />\r\n        <el-table-column prop=\"deviceName\" label=\"设备名称\" />\r\n        <el-table-column label=\"设备状态\" align=\"center\">\r\n          <template #default=\"scope\">\r\n            <el-tag :type=\"scope.row.deviceStatus === '在线' ? '' : 'info'\">{{ scope.row.deviceStatus }}</el-tag>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"lastOnlineTime\" label=\"最后在线时间\" />\r\n        <el-table-column label=\"操作\" align=\"center\">\r\n          <template #default=\"scope\">\r\n            <el-button link type=\"primary\" size=\"small\" @click.prevent=\"handleToChildPage(scope.$index, 'deviceInfo')\">详情</el-button>\r\n            <el-button link type=\"primary\" size=\"small\" @click.prevent=\"handleToChildPage(scope.$index, 'dataStream')\">数据流</el-button>\r\n            <el-dropdown trigger=\"click\" placement=\"bottom\" :hide-on-click=\"false\">\r\n              <el-button link type=\"primary\" size=\"small\">\r\n                <template #default>\r\n                  更多操作\r\n                  <el-icon class=\"el-icon--right\">\r\n                    <arrow-down />\r\n                  </el-icon>\r\n                </template>\r\n              </el-button>\r\n              <template #dropdown>\r\n                <el-dropdown-menu>\r\n                  <el-dropdown-item @click.prevent=\"handleToChildPage(scope.$index, 'command')\">下发指令</el-dropdown-item>\r\n                  <el-dropdown-item>\r\n                    <template #default>\r\n                      <el-popconfirm\r\n                        title=\"确认删除?\"\r\n                        confirm-button-type=\"danger\"\r\n                        confirm-button-text=\"确认\"\r\n                        cancel-button-text=\"取消\"\r\n                        @confirm=\"handleClickDel(scope.$index)\"\r\n                      >\r\n                        <template #reference>\r\n                          删除\r\n                        </template>\r\n                      </el-popconfirm>\r\n                    </template>\r\n                  </el-dropdown-item>\r\n                </el-dropdown-menu>\r\n              </template>\r\n            </el-dropdown>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n      <div id=\"pagination\">\r\n        <el-pagination\r\n          background\r\n          layout=\"prev, pager, next\"\r\n          :total=\"deviceCount\"\r\n          :page-size=\"7\"\r\n          @current-change=\"(e) => getDeviceList(e, 7)\"\r\n        />\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport MainAppHeader from '@/components/mainAppHeader'\r\nimport EditDrawer from '@/views/deviceList/component/editDrawer'\r\nimport { reactive, ref, onMounted, onUnmounted } from 'vue'\r\nimport { useRouterStore } from '@/store/router'\r\nimport { useRouter } from 'vue-router'\r\nimport { fetchDeviceList, fetchDeviceStatus, deleteDevice } from '@/apis/device'\r\nimport { ElMessage } from 'element-plus'\r\nimport { formatDate } from '@/utils/formatDate'\r\n\r\nconst drawerSwitch = ref(true)\r\nconst routerStore = useRouterStore()\r\nconst productId = ref(routerStore.productId)\r\nconst deviceList = reactive([])\r\nconst deviceIdList = reactive([])\r\nlet timer\r\nfunction getStatusTimerFun() {\r\n  updateDeviceStatus()\r\n  timer = setTimeout(getStatusTimerFun, 8 * 1000)\r\n}\r\nonMounted(() => {\r\n  getDeviceList()\r\n  getStatusTimerFun()\r\n})\r\n\r\nonUnmounted(() => {\r\n  clearTimeout(timer)\r\n})\r\n\r\nconst deviceCount = ref(0)\r\nconst onlineDeviceCount = ref(0)\r\nconst isLoading = ref(false)\r\nfunction getDeviceList(page = 1, pageSize = 8) {\r\n  isLoading.value = true\r\n  fetchDeviceList({ productId: productId.value, page, pageSize }).then(res => {\r\n    if (res.code === 200) {\r\n      deviceCount.value = res.data.total\r\n      onlineDeviceCount.value = 0\r\n      //  处理返回的设备列表数组\r\n      if (res.data.devicelist) {\r\n        deviceIdList.splice(0)\r\n        res.data.devicelist.forEach(item => {\r\n          deviceIdList.push(item.deviceId)\r\n          item.lastOnlineTime = formatDate(item.lastOnlineTime)\r\n          if (item.deviceStatus === '在线') {\r\n            onlineDeviceCount.value++\r\n            item.lastOnlineTime = '- - -'\r\n          }\r\n        })\r\n        deviceList.splice(0)\r\n        deviceList.push(...res.data.devicelist)\r\n      }\r\n    } else if (res.code === 500) {\r\n    //  请求成功但没有数据\r\n      deviceCount.value = 0\r\n      deviceList.splice(0)\r\n    }\r\n  }, () => {\r\n    ElMessage({\r\n      type: 'error',\r\n      message: '网络错误'\r\n    })\r\n  }).finally(() => {\r\n    isLoading.value = false\r\n  })\r\n}\r\n\r\nconst router = useRouter()\r\nfunction handleToChildPage(index, routerName) {\r\n  router.push({ name: routerName, params: { productId: routerStore.productId, deviceId: deviceList[index].deviceId }})\r\n}\r\n\r\nfunction updateDeviceStatus() {\r\n  fetchDeviceStatus({ productId: routerStore.productId, deviceId: deviceIdList }).then(res => {\r\n    if (res.code === 200) {\r\n      deviceList.forEach(device => {\r\n        res.data.forEach(deviceIdItem => {\r\n          if (device.deviceId === deviceIdItem.deviceId) {\r\n            device.deviceStatus = deviceIdItem.deviceStatus\r\n            device.deviceStatus === '在线'\r\n              ? device.lastOnlineTime = '- - -'\r\n              : device.lastOnlineTime = formatDate(deviceIdItem.lastOnlineTime)\r\n          }\r\n        })\r\n      })\r\n    }\r\n  })\r\n}\r\nfunction handleClickDel(index) {\r\n  isLoading.value = true\r\n  deleteDevice({ productId: routerStore.productId, deviceId: deviceList[index].deviceId }).then(res => {\r\n    if (res.code === 200) {\r\n      ElMessage({\r\n        type: 'success',\r\n        message: '删除成功'\r\n      })\r\n      getDeviceList()\r\n    }\r\n  }, () => {\r\n    ElMessage({\r\n      type: 'error',\r\n      message: '网络错误'\r\n    })\r\n  }).finally(() => {\r\n    isLoading.value = false\r\n  })\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.container-context {\r\n  background-color: white;\r\n  border: 1px solid #eeeeee;\r\n  border-radius: 5px;\r\n  padding: 2em;\r\n  margin-top: 1em;\r\n}\r\n#header-container {\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: space-around;\r\n  text-align: center;\r\n}\r\n.container-info {\r\n  margin-right: 3em;\r\n}\r\n#action-area {\r\n  margin-left: auto;\r\n}\r\nspan.title-header {\r\n  font-size: 0.8em;\r\n  color: #837983;\r\n}\r\n.title-header~span {\r\n  font-size: 1.3em;\r\n}\r\n.el-dropdown {\r\n  margin-top: 4px;\r\n  margin-left: 1em;\r\n}\r\n#pagination {\r\n  display: flex;\r\n  justify-content: right;\r\n  margin-right: 8%;\r\n  padding-bottom: 2em;\r\n}\r\n</style>\r\n","import script from \"./index.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./index.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=6dc48376&scoped=true&lang=css\"\n\nimport exportComponent from \"D:\\\\javaWeb\\\\vuePro\\\\xin_gong_ke\\\\iot-page\\\\node_modules\\\\.pnpm\\\\vue-loader@16.8.3_5vqgdkn543z7gobmtemdwwisxa\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-6dc48376\"]])\n\nexport default __exports__","import request from '@/utils/axios'\r\n\r\nexport function addDevice(data) {\r\n  return request({\r\n    url: '/api/data/addDevice',\r\n    method: 'POST',\r\n    data\r\n  })\r\n}\r\n\r\nexport function fetchDeviceList(params) {\r\n  return request({\r\n    url: '/api/data/fetchDeviceList',\r\n    method: 'GET',\r\n    params\r\n  })\r\n}\r\n\r\nexport function fetchDeviceInfo(params) {\r\n  return request({\r\n    url: '/api/data/fetchDeviceInfo',\r\n    method: 'GET',\r\n    params\r\n  })\r\n}\r\n\r\nexport function fetchDeviceStatus(data) {\r\n  return request({\r\n    url: '/api/data/fetchDeviceStatus',\r\n    method: 'POST',\r\n    data\r\n  })\r\n}\r\n\r\nexport function deviceDataUploadInfo(params) {\r\n  return request({\r\n    url: '/api/data/deviceDataUploadInfo',\r\n    method: 'GET',\r\n    params\r\n  })\r\n}\r\n\r\nexport function deleteDevice(params) {\r\n  return request({\r\n    url: '/api/data/deleteDevice',\r\n    method: 'DELETE',\r\n    params\r\n  })\r\n}\r\n\r\nexport function sendCommand(data) {\r\n  return request({\r\n    url: '/api/data/sendCommand',\r\n    method: 'POST',\r\n    data\r\n  })\r\n}\r\n\r\nexport function fetchCommandList(params) {\r\n  return request({\r\n    url: '/api/data/fetchCommandList',\r\n    method: 'GET',\r\n    params\r\n  })\r\n}\r\n\r\nexport function addApiKey(params) {\r\n  return request({\r\n    url: '/api/data/addApiKey',\r\n    month: 'GET',\r\n    params\r\n  })\r\n}\r\n","<template>\r\n  <el-drawer v-model=\"isShowDrawer\">\r\n    <template #header>\r\n      <div>\r\n        <h2>{{ drawerTitle }}</h2>\r\n        <hr color=\"#e8eaec\">\r\n      </div>\r\n    </template>\r\n    <template #default>\r\n      <el-form ref=\"deviceForm\" :model=\"deviceData\" :rules=\"rules\" label-position=\"top\">\r\n        <el-form-item label=\"设备名称\" prop=\"deviceName\">\r\n          <el-input v-model=\"deviceData.deviceName\" placeholder=\"1-20个字符\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"鉴权信息\" prop=\"deviceAuthentication\">\r\n          <el-input v-model=\"deviceData.deviceAuthentication\" placeholder=\"6-24个字符\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"设备描述\" prop=\"deviceIntroduction\">\r\n          <el-input v-model=\"deviceData.deviceIntroduction\" placeholder=\"1-50个字符\" />\r\n        </el-form-item>\r\n      </el-form>\r\n    </template>\r\n    <template #footer>\r\n      <div style=\"flex: auto\">\r\n        <el-button @click=\"resetForm(deviceForm)\">取消</el-button>\r\n        <el-button type=\"primary\" :loading=\"isButtonLoading\" @click=\"handleAddDevice\">确定</el-button>\r\n      </div>\r\n    </template>\r\n  </el-drawer>\r\n</template>\r\n\r\n<script setup>\r\nimport { defineProps, watch, ref, reactive, defineEmits } from 'vue'\r\nimport { useRouterStore } from '@/store/router'\r\nimport { addDevice } from '@/apis/device'\r\nimport { ElMessage } from 'element-plus'\r\n\r\nconst props = defineProps({\r\n  drawerSwitch: {\r\n    type: Boolean,\r\n    default: true\r\n  },\r\n  drawerTitle: {\r\n    type: String,\r\n    default: 'default_title'\r\n  },\r\n  deviceEditData: {\r\n    type: Object,\r\n    default() {\r\n      return {}\r\n    }\r\n  }\r\n})\r\nconst emits = defineEmits(['onUpdated'])\r\n\r\nconst isShowDrawer = ref(false)\r\nconst deviceForm = ref(null)\r\nconst message = ref('添加设备成功')\r\n\r\nwatch(\r\n  () => props.drawerSwitch,\r\n  () => {\r\n    //  当结果为true时，说明有传数据过来，也就是编辑设备信息\r\n    if (JSON.stringify(props.deviceEditData) !== '{}') {\r\n      deviceData.deviceName = props.deviceEditData.deviceName\r\n      deviceData.deviceAuthentication = props.deviceEditData.deviceAuthentication\r\n      deviceData.deviceIntroduction = props.deviceEditData.deviceIntroduction\r\n      deviceData.deviceId = props.deviceEditData.deviceId\r\n      message.value = '更新信息成功'\r\n    } else {\r\n      deviceData.deviceId = ''\r\n      deviceData.deviceName = ''\r\n      deviceData.deviceAuthentication = ''\r\n      deviceData.deviceIntroduction = ''\r\n      message.value = '添加设备成功'\r\n    }\r\n\r\n    isShowDrawer.value = true\r\n  }\r\n)\r\n\r\nconst routerStore = useRouterStore()\r\nconst deviceData = reactive({\r\n  productId: routerStore.productId,\r\n  deviceId: '',\r\n  deviceName: '',\r\n  deviceAuthentication: '',\r\n  deviceIntroduction: ''\r\n})\r\nconst rules = reactive({\r\n  deviceName: [\r\n    { required: true, message: '设备名不能为空', trigger: 'blur' },\r\n    { min: 1, max: 20, message: '长度须为1-20', trigger: 'blur' }\r\n  ],\r\n  deviceAuthentication: [\r\n    { required: true, message: '设备鉴权信息不能为空', trigger: 'blur' },\r\n    { min: 6, max: 24, message: '长度须为6-24', trigger: 'blur' }\r\n  ],\r\n  deviceIntroduction: [\r\n    { min: 0, max: 50, message: '长度不能超过50个字符', trigger: 'blur' }\r\n  ]\r\n})\r\n\r\nfunction handleFetchDeviceList() {\r\n  emits('onUpdated')\r\n}\r\n\r\nconst isButtonLoading = ref(false)\r\nfunction resetForm(form) {\r\n  isShowDrawer.value = false\r\n  isButtonLoading.value = false\r\n  form.resetFields()\r\n}\r\nfunction handleAddDevice() {\r\n  deviceForm.value.validate(isValid => {\r\n    if (isValid) {\r\n      isButtonLoading.value = true\r\n      addDevice(deviceData).then(res => {\r\n        if (res.code === 200) {\r\n          ElMessage({\r\n            type: 'success',\r\n            message: message.value\r\n          })\r\n          handleFetchDeviceList()\r\n          isShowDrawer.value = false\r\n        } else {\r\n          ElMessage({\r\n            type: 'error',\r\n            message: '未知错误'\r\n          })\r\n        }\r\n      }, () => {\r\n        ElMessage({\r\n          type: 'error',\r\n          message: '网络错误'\r\n        })\r\n      }).finally(() => {\r\n        isButtonLoading.value = false\r\n      })\r\n    }\r\n  })\r\n}\r\n</script>\r\n","import script from \"./editDrawer.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./editDrawer.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__","export * from \"-!../../node_modules/.pnpm/mini-css-extract-plugin@0.9.0_webpack@4.46.0/node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../node_modules/.pnpm/vue-loader@16.8.3_5vqgdkn543z7gobmtemdwwisxa/node_modules/vue-loader/dist/stylePostLoader.js!../../node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../node_modules/.pnpm/cache-loader@4.1.0_webpack@4.46.0/node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/.pnpm/vue-loader@16.8.3_5vqgdkn543z7gobmtemdwwisxa/node_modules/vue-loader/dist/index.js??ref--1-1!./mainAppHeader.vue?vue&type=style&index=0&id=4b858026&scoped=true&lang=css\"","export * from \"-!../../../node_modules/.pnpm/mini-css-extract-plugin@0.9.0_webpack@4.46.0/node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../../node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../../node_modules/.pnpm/vue-loader@16.8.3_5vqgdkn543z7gobmtemdwwisxa/node_modules/vue-loader/dist/stylePostLoader.js!../../../node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../../node_modules/.pnpm/cache-loader@4.1.0_webpack@4.46.0/node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/.pnpm/vue-loader@16.8.3_5vqgdkn543z7gobmtemdwwisxa/node_modules/vue-loader/dist/index.js??ref--1-1!./index.vue?vue&type=style&index=0&id=6dc48376&scoped=true&lang=css\""],"sourceRoot":""}