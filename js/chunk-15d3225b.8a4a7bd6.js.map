{"version":3,"sources":["webpack:///./src/apis/user.js","webpack:///./src/utils/debounceThrottle.js","webpack:///./src/components/captcha.vue","webpack:///./src/components/captcha.vue?79de","webpack:///./src/components/layoutHeader.vue?97b1","webpack:///./src/components/layoutHeader.vue","webpack:///./src/components/layoutHeader.vue?c71c","webpack:///./src/views/login/index.vue","webpack:///./src/views/login/index.vue?6e3b","webpack:///./src/views/login/index.vue?637d"],"names":["login","data","request","url","method","getUserInfo","getEmailCode","emailLogin","register","throttle","func","ms","isThrottled","apply","this","arguments","setTimeout","canvas","ref","updateCaptcha","Event","handleGetCaptcha","canvasElement","codeCount","ctx","getContext","save","addEventListener","getCaptcha","restore","clearRect","result","font","textBaseline","translate","i","code","getRandomInt","fillStyle","getRandomRGB","rotate","getRandomAngle","Math","PI","fillText","emits","max","min","floor","random","maxAbsolute","isMinus","onMounted","value","dispatchEvent","watch","props","noMatchCode","__exports__","router","useRouter","handleBackLogin","push","name","loginFrom","emailLoginFrom","textGetCodeButton","isLogin","reactive","nlLoginNoMatchCaptchaCode","elLoginNoMatchCaptchaCode","loginData","userName","password","captcha","emailLoginData","userEmail","emailCode","buttonGetCode","isCodeCD","buttonText","tabName","emitCaptcha","nlCaptcha","eCaptcha","rules","required","message","trigger","validator","checkCaptcha","emailRules","checkEmail","userStore","useUserStore","handleTabChange","tabPaneName","handleLogin","tab","validate","valid","fields","upLogin","eLogin","console","log","rule","callback","Error","test","handleGetCaptchaEmail","loginFromRef","then","res","handleLoginSuccess","resetFields","ElMessage","type","rej","handleGetEmailCode","codeCD","classList","toggle","countCD","setInterval","clearInterval","validateField","isValid","asyncAddRouter","resetUserToken"],"mappings":"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","file":"js/chunk-15d3225b.8a4a7bd6.js","sourcesContent":["import request from '@/utils/axios'\r\n\r\nexport function login(data) {\r\n  return request({\r\n    url: '/api/user/login',\r\n    method: 'POST',\r\n    data\r\n  })\r\n}\r\n\r\nexport function getUserInfo() {\r\n  return request({\r\n    url: 'api/user/getUserInfo',\r\n    method: 'GET'\r\n  })\r\n}\r\n\r\nexport function getEmailCode(data) {\r\n  return request({\r\n    url: '/api/user/getEmailCode',\r\n    method: 'post',\r\n    data\r\n  })\r\n}\r\n\r\nexport function emailLogin(data) {\r\n  return request({\r\n    url: '/api/user/emailLogin',\r\n    method: 'post',\r\n    data\r\n  })\r\n}\r\n\r\nexport function register(data) {\r\n  return request({\r\n    url: '/api/user/register',\r\n    method: 'POST',\r\n    data\r\n  })\r\n}\r\n","export function debounce(func, ms) {\r\n  let timer\r\n  return function() {\r\n    clearTimeout(timer)\r\n    setTimeout(() => func.apply(this, arguments), ms)\r\n  }\r\n}\r\n\r\nexport function throttle(func, ms) {\r\n  let isThrottled = false\r\n\r\n  return function() {\r\n    if (isThrottled) {\r\n      return\r\n    }\r\n    isThrottled = true\r\n\r\n    func.apply(this, arguments)\r\n\r\n    setTimeout(() => {\r\n      isThrottled = false\r\n    }, ms)\r\n  }\r\n}\r\n","<template>\r\n  <canvas ref=\"canvas\" width=\"80\" height=\"30\" />\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, defineEmits, defineProps, watch } from 'vue'\r\nimport { throttle } from '@/utils/debounceThrottle'\r\n\r\nconst emits = defineEmits(['getCaptcha'])\r\nconst props = defineProps({\r\n  noMatchCode: {\r\n    type: Boolean,\r\n    default: false\r\n  }\r\n})\r\nconst canvas = ref(null)\r\n\r\nconst updateCaptcha = new Event('updateCaptcha')\r\n\r\nonMounted(() => {\r\n  canvas.value.addEventListener('click', throttle(() => canvas.value.dispatchEvent(updateCaptcha), 500))\r\n  handleGetCaptcha(canvas.value, 4)\r\n\r\n  watch(\r\n    () => props.noMatchCode,\r\n    () => {\r\n      canvas.value.dispatchEvent(updateCaptcha)\r\n    }\r\n  )\r\n})\r\n\r\nfunction handleGetCaptcha(canvasElement, codeCount) {\r\n  const ctx = canvasElement.getContext('2d')\r\n  ctx.save()\r\n  canvasElement.addEventListener('updateCaptcha', () => getCaptcha(ctx, codeCount))\r\n  getCaptcha(ctx, codeCount)\r\n}\r\n\r\nfunction getCaptcha(ctx, codeCount) {\r\n  ctx.restore()\r\n  ctx.restore()\r\n  ctx.clearRect(0, 0, 80, 30)\r\n  ctx.save()\r\n  let result = ''\r\n  // 设置字体样式\r\n  ctx.font = 'bold 15px serif'\r\n  // 设置文字基线\r\n  ctx.textBaseline = 'top'\r\n  // 设置初始落点\r\n  ctx.translate(10, 5)\r\n  // 保存初始设置\r\n  ctx.save()\r\n\r\n  let i = 0\r\n  while (i < codeCount) {\r\n    const code = getRandomInt(9, 0)\r\n    result = result + '' + code\r\n\r\n    ctx.restore()\r\n    ctx.save()\r\n    ctx.fillStyle = getRandomRGB()\r\n    ctx.translate((i) * getRandomInt(20, 15), 0)\r\n    ctx.rotate(getRandomAngle(40) * Math.PI / 180)\r\n    ctx.fillText(code, 0, 0)\r\n\r\n    i++\r\n  }\r\n  emits('getCaptcha', result)\r\n}\r\n\r\nfunction getRandomInt(max = 1, min = 0) {\r\n  return Math.floor(Math.random() * (max - min)) + min\r\n}\r\n\r\nfunction getRandomRGB() {\r\n  return `rgb(${getRandomInt(255)}, ${getRandomInt(255)}, ${getRandomInt(255)})`\r\n}\r\n\r\nfunction getRandomAngle(maxAbsolute, isMinus = 0) {\r\n  if (isMinus === 0) {\r\n    if (Math.random() >= 0.5) {\r\n      return getRandomAngle(maxAbsolute, 1)\r\n    } else {\r\n      return getRandomAngle(maxAbsolute, -1)\r\n    }\r\n  } else if (isMinus < 0) {\r\n    return -getRandomInt(maxAbsolute)\r\n  } else {\r\n    return getRandomInt(maxAbsolute)\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>\r\n","import script from \"./captcha.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./captcha.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__","export * from \"-!../../node_modules/.pnpm/mini-css-extract-plugin@0.9.0_webpack@4.46.0/node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../node_modules/.pnpm/vue-loader@16.8.3_5vqgdkn543z7gobmtemdwwisxa/node_modules/vue-loader/dist/stylePostLoader.js!../../node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../node_modules/.pnpm/cache-loader@4.1.0_webpack@4.46.0/node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/.pnpm/vue-loader@16.8.3_5vqgdkn543z7gobmtemdwwisxa/node_modules/vue-loader/dist/index.js??ref--1-1!./layoutHeader.vue?vue&type=style&index=0&id=89c18978&scoped=true&lang=css\"","<template>\r\n  <div id=\"header\">\r\n    <div id=\"back-icon\">\r\n      <slot name=\"backIcon\" />\r\n    </div>\r\n    <div id=\"icon-logo\" class=\"slot\">\r\n      <img src=\"https://img1.imgtp.com/2022/10/15/TP8TMu93.png\" alt=\"logo\" height=\"48\" width=\"78\" @click=\"handleBackLogin\">\r\n    </div>\r\n    <div id=\"avatar\" class=\"slot\">\r\n      <slot name=\"avatar\" />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { useRouter } from 'vue-router'\r\nconst router = useRouter()\r\n\r\nfunction handleBackLogin() {\r\n  router.push({ name: 'login' })\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n#header {\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  background-color: #fefefe;\r\n  box-shadow: #b2b2b2 0 3px 10px;\r\n  position: sticky;\r\n  top: 0;\r\n  z-index: 999;\r\n}\r\n#back-icon {\r\n  margin-left: 2em;\r\n  width: 92px;\r\n}\r\n#icon-logo {\r\n  margin-right: auto;\r\n  margin-left: 3%;\r\n  background-color: #0093E9;\r\n  background-image: linear-gradient(151deg, #0093E9 0%, #80D0C7 68%);\r\n  border-radius: 10px;\r\n}\r\n#avatar {\r\n  margin-right: 3em;\r\n}\r\n.slot {\r\n  margin-top: 3px;\r\n  margin-bottom: 3px;\r\n  cursor: pointer;\r\n}\r\n</style>\r\n","import script from \"./layoutHeader.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./layoutHeader.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./layoutHeader.vue?vue&type=style&index=0&id=89c18978&scoped=true&lang=css\"\n\nimport exportComponent from \"D:\\\\javaWeb\\\\vuePro\\\\xin_gong_ke\\\\iot-page\\\\node_modules\\\\.pnpm\\\\vue-loader@16.8.3_5vqgdkn543z7gobmtemdwwisxa\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-89c18978\"]])\n\nexport default __exports__","<template>\r\n  <div id=\"content\" v-loading:body=\"isLogin\">\r\n    <layout-header />\r\n    <div id=\"main-box\">\r\n      <div id=\"box-left\" />\r\n      <div id=\"box-right\">\r\n        <div id=\"tabs-login\">\r\n          <el-tabs v-model=\"tabName\" type=\"border-card\" :stretch=\"true\" @tab-change=\"handleTabChange\">\r\n            <el-tab-pane label=\"密码登录\" name=\"loginFrom\">\r\n              <el-form ref=\"loginFrom\" :model=\"loginData\" :rules=\"rules\">\r\n                <el-form-item prop=\"userName\">\r\n                  <el-input v-model=\"loginData.userName\" placeholder=\"请输入账号\" />\r\n                </el-form-item>\r\n                <el-form-item prop=\"password\">\r\n                  <el-input v-model=\"loginData.password\" type=\"password\" show-password placeholder=\"请输入密码\" />\r\n                </el-form-item>\r\n                <el-form-item prop=\"captcha\">\r\n                  <el-input v-model=\"loginData.captcha\" placeholder=\"输入图形验证码\" type=\"text\">\r\n                    <template #append>\r\n                      <div class=\"img-code\">\r\n                        <captcha :no-match-code=\"noMatchCode.nlLoginNoMatchCaptchaCode\" @get-captcha=\"handleGetCaptcha\" />\r\n                      </div>\r\n                    </template>\r\n                  </el-input>\r\n                </el-form-item>\r\n              </el-form>\r\n            </el-tab-pane>\r\n            <el-tab-pane label=\"验证码登录\" name=\"emailLoginFrom\">\r\n              <el-form ref=\"emailLoginFrom\" :model=\"emailLoginData\" :rules=\"emailRules\">\r\n                <el-form-item prop=\"userEmail\">\r\n                  <el-input v-model=\"emailLoginData.userEmail\" type=\"text\" placeholder=\"输入邮箱\" />\r\n                </el-form-item>\r\n                <el-form-item prop=\"captcha\">\r\n                  <el-input v-model=\"emailLoginData.captcha\" placeholder=\"输入图形验证码\" type=\"text\">\r\n                    <template #append>\r\n                      <div class=\"img-code\">\r\n                        <captcha :no-match-code=\"noMatchCode.elLoginNoMatchCaptchaCode\" @get-captcha=\"handleGetCaptchaEmail\" />\r\n                      </div>\r\n                    </template>\r\n                  </el-input>\r\n                </el-form-item>\r\n                <el-form-item prop=\"emailCode\">\r\n                  <el-input v-model=\"emailLoginData.emailCode\" type=\"text\" placeholder=\"输入验证码\">\r\n                    <template #append>\r\n                      <el-button\r\n                        type=\"primary\"\r\n                        :disabled=\"buttonGetCode.isCodeCD\"\r\n                        @click=\"handleGetEmailCode(emailLoginFrom, textGetCodeButton)\"\r\n                      >\r\n                        <span id=\"text-getCode-button\" ref=\"textGetCodeButton\">{{ buttonGetCode.buttonText }}</span>\r\n                      </el-button>\r\n                    </template>\r\n                  </el-input>\r\n                </el-form-item>\r\n              </el-form>\r\n            </el-tab-pane>\r\n          </el-tabs>\r\n          <button id=\"button-login\" @click=\"handleLogin(tabName)\"><span>登录</span></button>\r\n          <hr color=\"#dcdfe6\">\r\n          <div id=\"router-link-register\">\r\n            <router-link to=\"/register\"><span id=\"text-register\">注册账号</span></router-link>\r\n            <router-link to=\"/resetPassword\"><span id=\"text-register\">忘记密码/修改密码</span></router-link>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport Captcha from '@/components/captcha'\r\nimport { login, getEmailCode, emailLogin } from '@/apis/user'\r\nimport { ref, reactive, onMounted } from 'vue'\r\nimport { ElMessage } from 'element-plus'\r\nimport router from '@/router/index'\r\nimport { asyncAddRouter } from '@/router'\r\nimport LayoutHeader from '@/components/layoutHeader'\r\nimport { useUserStore } from '@/store/user'\r\n\r\nconst loginFrom = ref(null)\r\nconst emailLoginFrom = ref(null)\r\nconst textGetCodeButton = ref(null)\r\nconst isLogin = ref(false)\r\nconst noMatchCode = reactive({\r\n  nlLoginNoMatchCaptchaCode: false,\r\n  elLoginNoMatchCaptchaCode: false\r\n})\r\nconst loginData = reactive({\r\n  userName: '',\r\n  password: '',\r\n  captcha: ''\r\n})\r\nconst emailLoginData = reactive({\r\n  userEmail: '',\r\n  emailCode: ''\r\n})\r\nconst buttonGetCode = reactive({\r\n  isCodeCD: false,\r\n  buttonText: '获取验证码'\r\n})\r\nconst tabName = ref('loginFrom')\r\nconst emitCaptcha = reactive({\r\n  nlCaptcha: '',\r\n  eCaptcha: ''\r\n})\r\nconst rules = reactive({\r\n  userName: [\r\n    { required: true, message: '账号不能为空', trigger: 'blur' }\r\n  ],\r\n  password: [\r\n    { required: true, message: '密码不能为空', trigger: 'blur' }\r\n  ],\r\n  captcha: [\r\n    { validator: checkCaptcha, trigger: 'blur' }\r\n  ]\r\n})\r\n\r\nconst emailRules = reactive({\r\n  captcha: [\r\n    { validator: checkCaptcha, trigger: 'blur' }\r\n  ],\r\n  userEmail: [\r\n    { validator: checkEmail, trigger: 'blur' }\r\n  ],\r\n  emailCode: [\r\n    { required: true, message: '请输入验证码', trigger: 'blur' },\r\n    { min: 4, max: 4, message: '验证码格式为4位', trigger: 'blur' }\r\n  ]\r\n})\r\n\r\nconst userStore = useUserStore()\r\nonMounted(() => {\r\n  userStore.resetUserToken()\r\n})\r\n\r\nfunction handleTabChange(tabPaneName) {\r\n  loginData.captcha = ''\r\n}\r\n\r\nfunction handleLogin(tab) {\r\n  isLogin.value = true\r\n  let ref\r\n  if (tab === 'loginFrom') {\r\n    ref = loginFrom.value\r\n  } else {\r\n    ref = emailLoginFrom.value\r\n  }\r\n  ref.validate((valid, fields) => {\r\n    if (valid) {\r\n      if (tabName.value === 'loginFrom') {\r\n        upLogin(ref)\r\n      } else {\r\n      //  验证码登录\r\n        eLogin(ref)\r\n      }\r\n    } else {\r\n      console.log('error submit!', fields)\r\n      isLogin.value = false\r\n    }\r\n  })\r\n}\r\n\r\nfunction checkCaptcha(rule, value, callback) {\r\n  if (value === '') {\r\n    return callback(new Error('请输入验证码'))\r\n  } else {\r\n    if (tabName.value === 'loginFrom') {\r\n      if (value !== emitCaptcha.nlCaptcha) {\r\n        noMatchCode.nlLoginNoMatchCaptchaCode = !noMatchCode.nlLoginNoMatchCaptchaCode\r\n        // 两个组件共用一个事件似乎是不行\r\n        return callback(new Error('验证码错误'))\r\n      }\r\n    } else {\r\n      if (value !== emitCaptcha.eCaptcha) {\r\n        noMatchCode.elLoginNoMatchCaptchaCode = !noMatchCode.elLoginNoMatchCaptchaCode\r\n        return callback(new Error('验证码错误'))\r\n      }\r\n    }\r\n    return callback()\r\n  }\r\n}\r\n\r\nfunction checkEmail(rule, value, callback) {\r\n  if (value === '') {\r\n    return callback(new Error('请输入邮箱'))\r\n  } else if (!(/^[^@]+@[^@]+$/.test(value))) {\r\n    return callback(new Error('请输入正确的邮箱'))\r\n  } else {\r\n    callback()\r\n  }\r\n}\r\n\r\nfunction handleGetCaptcha(captcha) {\r\n  emitCaptcha.nlCaptcha = captcha\r\n}\r\n\r\nfunction handleGetCaptchaEmail(captcha) {\r\n  emitCaptcha.eCaptcha = captcha\r\n}\r\n\r\nfunction upLogin(loginFromRef) {\r\n  login({ userName: loginData.userName, password: loginData.password }).then(res => {\r\n    if (res.code === 200) {\r\n      //  登录成功，转跳产品页面\r\n      handleLoginSuccess(res)\r\n    } else {\r\n      //  账号密码错误，清空表单，重置验证码，触发全局通知\r\n      isLogin.value = false\r\n      loginFromRef.resetFields()\r\n      noMatchCode.nlLoginNoMatchCaptchaCode = !noMatchCode.nlLoginNoMatchCaptchaCode\r\n      ElMessage({\r\n        message: '账号或密码错误',\r\n        type: 'error'\r\n      })\r\n    }\r\n    isLogin.value = false\r\n  }, rej => {\r\n    //  网络问题处理\r\n    console.log(rej)\r\n    ElMessage({\r\n      message: '网络错误，请稍后再试',\r\n      type: 'error'\r\n    })\r\n    noMatchCode.nlLoginNoMatchCaptchaCode = !noMatchCode.nlLoginNoMatchCaptchaCode\r\n    isLogin.value = false\r\n  })\r\n}\r\nfunction eLogin(loginFromRef) {\r\n  emailLogin({ userEmail: emailLoginData.userEmail, emailCode: emailLoginData.emailCode }).then(res => {\r\n    if (res.code === 200) {\r\n      //  登录成功，转跳产品页面\r\n      handleLoginSuccess(res)\r\n    } else {\r\n      //  验证码错误，清空表单，重置图形验证码，触发全局通知\r\n      isLogin.value = false\r\n      loginFromRef.resetFields()\r\n      noMatchCode.elLoginNoMatchCaptchaCode = !noMatchCode.elLoginNoMatchCaptchaCode\r\n      ElMessage({\r\n        message: '验证码错误',\r\n        type: 'error'\r\n      })\r\n    }\r\n    isLogin.value = false\r\n  }, rej => {\r\n    //  网络问题处理\r\n    console.log(rej)\r\n    ElMessage({\r\n      message: '网络错误，请稍后再试',\r\n      type: 'error'\r\n    })\r\n    noMatchCode.elLoginNoMatchCaptchaCode = !noMatchCode.elLoginNoMatchCaptchaCode\r\n    isLogin.value = false\r\n  })\r\n}\r\n\r\nfunction handleGetEmailCode(emailLoginFrom, textGetCodeButton) {\r\n  let codeCD = 60\r\n\r\n  //  disable按钮，并设置定时器\r\n  buttonGetCode.isCodeCD = true\r\n\r\n  textGetCodeButton.classList.toggle('text-getCode-button')\r\n\r\n  const countCD = setInterval(() => {\r\n    buttonGetCode.buttonText = `重新获取(${codeCD})`\r\n    codeCD -= 1\r\n    if (codeCD < 0) {\r\n      clearInterval(countCD)\r\n      buttonGetCode.isCodeCD = false\r\n      textGetCodeButton.classList.toggle('text-getCode-button')\r\n      buttonGetCode.buttonText = '重新获取验证码'\r\n    }\r\n  }, 900)\r\n\r\n  ElMessage({\r\n    message: '验证码已发送',\r\n    type: 'success'\r\n  })\r\n\r\n  emailLoginFrom.validateField(['captcha', 'userEmail'], isValid => {\r\n    if (isValid) {\r\n      getEmailCode({ userEmail: emailLoginData.userEmail, type: 'login' }).then(res => {\r\n        if (res.code === 200) {\r\n          console.log('send')\r\n        }\r\n      }, rej => {\r\n        console.log(rej)\r\n        ElMessage({\r\n          message: '网络错误，请稍后再试',\r\n          type: 'error'\r\n        })\r\n      })\r\n    }\r\n  })\r\n}\r\n\r\nfunction handleLoginSuccess(res) {\r\n  isLogin.value = false\r\n  asyncAddRouter()\r\n  router.push('productList')\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n  #content {\r\n    height: 100vh;\r\n    background-image: url(\"https://img1.imgtp.com/2022/10/15/rhjs36rC.jpg\");\r\n  }\r\n  #main-box {\r\n    display: grid;\r\n    grid-template-columns: 1fr 4fr 4fr 1fr;\r\n    justify-items: center;\r\n    margin-top: 9em;\r\n  }\r\n  #box-right>div {\r\n    box-shadow: 0 0 18px 3px #7e7e7e;\r\n    height: 19em;\r\n    background-color: #ffffff;\r\n  }\r\n  #tabs-login>div {\r\n    border-bottom: none;\r\n  }\r\n  #box-left {\r\n    grid-column: 2  / 3;\r\n    grid-row: 1 / 2\r\n  }\r\n  #box-right {\r\n    grid-column: 3  / 4;\r\n    grid-row: 1 / 2;\r\n    width: 28vw;\r\n  }\r\n  .img-code {\r\n    height: 30px;\r\n  }\r\n  #text-getCode-button {\r\n    width: 6.2em;\r\n    color: #8cbeff;\r\n  }\r\n  #text-getCode-button.text-getCode-button {\r\n    color: #c4c4c4;\r\n  }\r\n  #button-login {\r\n    color: white;\r\n    background-color: #409eff;\r\n    border-radius: 3px;\r\n    border: #409eff 1px solid;\r\n    width: 94%;\r\n    height: 2em;\r\n    text-align: center;\r\n    margin-left: 3%;\r\n  }\r\n  #router-link-register {\r\n    display: grid;\r\n    grid-template-columns: 3% 47% 47% 3%;\r\n    margin-left: 3%;\r\n    font-size: 0.8rem;\r\n  }\r\n  #router-link-register a:first-child {\r\n    grid-area: 1/2/2/3;\r\n    justify-self: left;\r\n  }\r\n  #router-link-register a:last-child {\r\n    grid-area: 1/3/2/4;\r\n    justify-self: right;\r\n  }\r\n  #router-link-register > a {\r\n    color: rgb(12,128,254);\r\n    text-decoration-line: none;\r\n  }\r\n  #router-link-register>a:hover {\r\n    color: #57a2ff;\r\n  }\r\n  #icon-logo {\r\n    background-color: #57a2ff;\r\n  }\r\n</style>\r\n","import script from \"./index.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./index.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=5eb4a80a&scoped=true&lang=css\"\n\nimport exportComponent from \"D:\\\\javaWeb\\\\vuePro\\\\xin_gong_ke\\\\iot-page\\\\node_modules\\\\.pnpm\\\\vue-loader@16.8.3_5vqgdkn543z7gobmtemdwwisxa\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-5eb4a80a\"]])\n\nexport default __exports__","export * from \"-!../../../node_modules/.pnpm/mini-css-extract-plugin@0.9.0_webpack@4.46.0/node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../../node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../../node_modules/.pnpm/vue-loader@16.8.3_5vqgdkn543z7gobmtemdwwisxa/node_modules/vue-loader/dist/stylePostLoader.js!../../../node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../../node_modules/.pnpm/cache-loader@4.1.0_webpack@4.46.0/node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/.pnpm/vue-loader@16.8.3_5vqgdkn543z7gobmtemdwwisxa/node_modules/vue-loader/dist/index.js??ref--1-1!./index.vue?vue&type=style&index=0&id=5eb4a80a&scoped=true&lang=css\""],"sourceRoot":""}