{"version":3,"sources":["webpack:///./src/views/device/component/command.vue?2b16","webpack:///./src/utils/formatDate.js","webpack:///./src/apis/device.js","webpack:///./src/views/device/component/command.vue","webpack:///./src/views/device/component/command.vue?e22c"],"names":["formatDate","time","format","date","Date","year","getFullYear","month","getMonth","day","getDate","hour","getHours","min","getMinutes","sec","getSeconds","preArr","Array","apply","map","elem","index","replace","addDevice","data","request","url","method","fetchDeviceList","params","fetchDeviceInfo","fetchDeviceStatus","deviceDataUploadInfo","deleteDevice","sendCommand","fetchCommandList","addApiKey","isShowDrawer","ref","commandForm","routerStore","useRouterStore","isSendLoading","commandFormData","reactive","commandType","commandText","commandTableData","total","commandDataList","rules","required","message","trigger","validator","checkCommandText","currentPage","rule","value","callback","test","Error","cancelClick","console","log","handleCloseDrawer","confirmClick","form","validate","isValid","handleSendCommand","resetFields","handleOpenDrawer","parseInt","productId","deviceId","then","res","code","ElMessage","type","getCommandList","finally","watch","isTableLoading","page","pageSize","splice","push","commandList","forEach","item","createDate","onMounted","__exports__"],"mappings":"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","file":"js/chunk-4dd47f34.e7e926d3.js","sourcesContent":["export * from \"-!../../../../node_modules/.pnpm/mini-css-extract-plugin@0.9.0_webpack@4.46.0/node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../../../node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../../../node_modules/.pnpm/vue-loader@16.8.3_5vqgdkn543z7gobmtemdwwisxa/node_modules/vue-loader/dist/stylePostLoader.js!../../../../node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../../../node_modules/.pnpm/cache-loader@4.1.0_webpack@4.46.0/node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../node_modules/.pnpm/vue-loader@16.8.3_5vqgdkn543z7gobmtemdwwisxa/node_modules/vue-loader/dist/index.js??ref--1-1!./command.vue?vue&type=style&index=0&id=f39812ac&scoped=true&lang=css\"","export function formatDate(time, format = 'YY-MM-DD hh:mm:ss') {\r\n  const date = new Date(time)\r\n\r\n  const year = date.getFullYear()\r\n  const month = date.getMonth() + 1 // 月份是从0开始的\r\n  const day = date.getDate()\r\n  const hour = date.getHours()\r\n  const min = date.getMinutes()\r\n  const sec = date.getSeconds()\r\n  const preArr = Array.apply(null, Array(10)).map(function(elem, index) {\r\n    return '0' + index\r\n  })\r\n  // 开个长度为10的数组 格式为 00 01 02 03\r\n\r\n  return format.replace(/YY/g, year)\r\n    .replace(/MM/g, preArr[month] || month)\r\n    .replace(/DD/g, preArr[day] || day)\r\n    .replace(/hh/g, preArr[hour] || hour)\r\n    .replace(/mm/g, preArr[min] || min)\r\n    .replace(/ss/g, preArr[sec] || sec)\r\n}\r\n","import request from '@/utils/axios'\r\n\r\nexport function addDevice(data) {\r\n  return request({\r\n    url: '/api/data/addDevice',\r\n    method: 'POST',\r\n    data\r\n  })\r\n}\r\n\r\nexport function fetchDeviceList(params) {\r\n  return request({\r\n    url: '/api/data/fetchDeviceList',\r\n    method: 'GET',\r\n    params\r\n  })\r\n}\r\n\r\nexport function fetchDeviceInfo(params) {\r\n  return request({\r\n    url: '/api/data/fetchDeviceInfo',\r\n    method: 'GET',\r\n    params\r\n  })\r\n}\r\n\r\nexport function fetchDeviceStatus(data) {\r\n  return request({\r\n    url: '/api/data/fetchDeviceStatus',\r\n    method: 'POST',\r\n    data\r\n  })\r\n}\r\n\r\nexport function deviceDataUploadInfo(params) {\r\n  return request({\r\n    url: '/api/data/deviceDataUploadInfo',\r\n    method: 'GET',\r\n    params\r\n  })\r\n}\r\n\r\nexport function deleteDevice(params) {\r\n  return request({\r\n    url: '/api/data/deleteDevice',\r\n    method: 'DELETE',\r\n    params\r\n  })\r\n}\r\n\r\nexport function sendCommand(data) {\r\n  return request({\r\n    url: '/api/data/sendCommand',\r\n    method: 'POST',\r\n    data\r\n  })\r\n}\r\n\r\nexport function fetchCommandList(params) {\r\n  return request({\r\n    url: '/api/data/fetchCommandList',\r\n    method: 'GET',\r\n    params\r\n  })\r\n}\r\n\r\nexport function addApiKey(params) {\r\n  return request({\r\n    url: '/api/data/addApiKey',\r\n    month: 'GET',\r\n    params\r\n  })\r\n}\r\n","<template>\r\n  <div id=\"container-command\">\r\n    <div id=\"drawer-command\">\r\n      <el-drawer v-model=\"isShowDrawer\" :direction=\"'rtl'\">\r\n        <template #header>\r\n          <h4>下发命令</h4>\r\n        </template>\r\n        <template #default>\r\n          <div id=\"container-send-command\">\r\n            <el-form ref=\"commandForm\" :model=\"commandFormData\" label-position=\"left\" :rules=\"rules\">\r\n              <el-form-item label=\"命令类型:\" prop=\"commandType\">\r\n                <el-radio-group v-model=\"commandFormData.commandType\">\r\n                  <el-radio label=\"string\">字符串</el-radio>\r\n                  <el-radio label=\"number\">数字</el-radio>\r\n                </el-radio-group>\r\n              </el-form-item>\r\n              <el-form-item prop=\"commandText\">\r\n                <el-input\r\n                  v-model=\"commandFormData.commandText\"\r\n                  type=\"textarea\"\r\n                  :disabled=\"commandFormData.commandType === ''\"\r\n                  placeholder=\"输入命令\"\r\n                  clearable\r\n                  :maxlength=\"50\"\r\n                  show-word-limit\r\n                  :autosize=\"{ minRows: 5, maxRows: 7 }\"\r\n                />\r\n              </el-form-item>\r\n            </el-form>\r\n          </div>\r\n        </template>\r\n        <template #footer>\r\n          <div style=\"flex: auto\">\r\n            <el-button @click=\"cancelClick\">取消</el-button>\r\n            <el-button type=\"primary\" :loading=\"isSendLoading\" @click=\"confirmClick(commandForm)\">确定</el-button>\r\n          </div>\r\n        </template>\r\n      </el-drawer>\r\n    </div>\r\n    <div id=\"header-command\" class=\"context-container\">\r\n      <div id=\"table-command-count\">\r\n        <table>\r\n          <tr>\r\n            <td><span id=\"text-command-table-title\">命令数量</span></td>\r\n          </tr>\r\n          <tr>\r\n            <td><span id=\"text-command-table-count\">{{ commandTableData.total }}</span></td>\r\n          </tr>\r\n        </table>\r\n      </div>\r\n      <div id=\"button-command\">\r\n        <el-button type=\"primary\" @click=\"handleOpenDrawer\">下发指令</el-button>\r\n      </div>\r\n    </div>\r\n    <div id=\"body-command\" class=\"context-container\">\r\n      <el-table v-loading=\"isTableLoading\" :data=\"commandTableData.commandDataList\" style=\"width: 100%\">\r\n        <el-table-column prop=\"commandId\" label=\"命令id\" />\r\n        <el-table-column prop=\"commandText\" label=\"命令内容\" />\r\n        <el-table-column prop=\"createDate\" label=\"下发时间\" sortable sort-by />\r\n        <el-table-column prop=\"commandStatus\" label=\"命令状态\" />\r\n        <el-table-column prop=\"commandResponse\" label=\"命令响应\" />\r\n      </el-table>\r\n      <div id=\"footer-command\">\r\n        <el-pagination background layout=\"prev, pager, next\" :total=\"commandTableData.total\" @current-change=\"getCommandList\" />\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, onMounted, watch } from 'vue'\r\nimport { sendCommand, fetchCommandList } from '@/apis/device'\r\nimport { useRouterStore } from '@/store/router'\r\nimport { ElMessage } from 'element-plus'\r\nimport { formatDate } from '@/utils/formatDate'\r\n\r\nconst isShowDrawer = ref(false)\r\nconst commandForm = ref(null)\r\nconst routerStore = useRouterStore()\r\nconst isSendLoading = ref(false)\r\nconst commandFormData = reactive({\r\n  commandType: '',\r\n  commandText: ''\r\n})\r\nconst commandTableData = reactive({\r\n  total: 0,\r\n  commandDataList: []\r\n})\r\n\r\nconst rules = reactive({\r\n  commandType: [\r\n    { required: true, message: '数据类型不能为空', trigger: 'change' }\r\n  ],\r\n  commandText: [\r\n    { required: true, message: '命令文本不能为空', trigger: 'blur' },\r\n    { validator: checkCommandText, trigger: 'blur' }\r\n  ]\r\n})\r\n\r\nconst currentPage = ref(1)\r\nwatch(\r\n  () => currentPage.value,\r\n  () => {\r\n    getCommandList(currentPage.value)\r\n  }\r\n)\r\n\r\nfunction checkCommandText(rule, value, callback) {\r\n  if (commandFormData.commandType === 'number') {\r\n  //  用户选择下发命令为数字类型\r\n    if (/^\\d+$/.test(value)) {\r\n    //  通过验证\r\n      callback()\r\n    } else {\r\n      callback(new Error('命令应为全数字组成'))\r\n    }\r\n  } else {\r\n  //  用户选择下发命令为字符串类型\r\n    callback()\r\n  }\r\n}\r\n\r\nfunction cancelClick() {\r\n  console.log('cancel')\r\n  handleCloseDrawer()\r\n}\r\nfunction confirmClick(form) {\r\n  form.validate((isValid) => {\r\n    if (isValid) {\r\n      handleSendCommand()\r\n    }\r\n  })\r\n}\r\nfunction handleCloseDrawer() {\r\n  isShowDrawer.value = false\r\n  commandForm.value.resetFields(['commandText', 'commandType'])\r\n}\r\nfunction handleOpenDrawer() {\r\n  isShowDrawer.value = true\r\n}\r\nfunction handleSendCommand() {\r\n  isSendLoading.value = true\r\n  if (commandFormData.commandType === 'number') {\r\n    commandFormData.commandText = parseInt(commandFormData.commandText)\r\n  }\r\n  sendCommand({\r\n    productId: routerStore.productId,\r\n    deviceId: routerStore.deviceId,\r\n    commandText: commandFormData.commandText,\r\n    commandType: commandFormData.commandType\r\n  }).then(res => {\r\n    if (res.code === 200) {\r\n      ElMessage({\r\n        type: 'success',\r\n        message: '下发成功'\r\n      })\r\n      handleCloseDrawer()\r\n      getCommandList()\r\n    }\r\n  }).finally(() => {\r\n    isSendLoading.value = false\r\n  })\r\n}\r\n\r\nconst isTableLoading = ref(false)\r\nonMounted(() => {\r\n  getCommandList()\r\n})\r\nfunction getCommandList(page = 1, pageSize = 8) {\r\n  isTableLoading.value = true\r\n  fetchCommandList({\r\n    page,\r\n    pageSize,\r\n    productId: routerStore.productId,\r\n    deviceId: routerStore.deviceId\r\n  }).then(res => {\r\n    if (res.code === 200) {\r\n      commandTableData.total = res.data.total\r\n      commandTableData.commandDataList.splice(0)\r\n      commandTableData.commandDataList.push(...res.data.commandList)\r\n      commandTableData.commandDataList.forEach(item => {\r\n        item.createDate = formatDate(item.createDate)\r\n      })\r\n    }\r\n  }, () => {\r\n    ElMessage({\r\n      type: 'error',\r\n      message: '网络错误'\r\n    })\r\n  }).finally(() => {\r\n    isTableLoading.value = false\r\n  })\r\n}\r\n\r\n</script>\r\n\r\n<style scoped>\r\n#header-command {\r\n  display: flex;\r\n  flex-direction: row;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n}\r\n#table-command-count td{\r\n  text-align: center;\r\n  font-size: 0.8em;\r\n}\r\n#text-command-table-count {\r\n  font-size: 1.2rem;\r\n  font-weight: bold;\r\n}\r\n.context-container {\r\n  background-color: white;\r\n  border-radius: 5px;\r\n  width: 100%;\r\n  margin-top: 1em;\r\n  border: 1px solid #dcdfe6;\r\n  padding: 1em 1em;\r\n}\r\n#footer-command {\r\n  display: flex;\r\n  flex-direction:  row-reverse;\r\n  margin-right: 3em;\r\n  margin-top: 1em;\r\n}\r\n</style>\r\n","import script from \"./command.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./command.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./command.vue?vue&type=style&index=0&id=f39812ac&scoped=true&lang=css\"\n\nimport exportComponent from \"D:\\\\javaWeb\\\\vuePro\\\\xin_gong_ke\\\\iot-page\\\\node_modules\\\\.pnpm\\\\vue-loader@16.8.3_5vqgdkn543z7gobmtemdwwisxa\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-f39812ac\"]])\n\nexport default __exports__"],"sourceRoot":""}